<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Interactive Bible ‚Ä¢ Modern Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
:root {
  /* Vibrant color palette */
  --bg-gradient: linear-gradient(135deg, #e0f7fa, #80deea);
  --surface: #ffffff;
  --primary: #00bcd4;
  --primary-light: #26c6da;
  --accent: #ffca28;
  --neutral: #6e6e6e;
  --text: #263238;
  --radius: 12px;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
  --transition: 0.3s ease;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--bg-gradient);
  font-family: 'Inter', sans-serif;
  color: var(--text);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
header {
  background: var(--primary);
  color: #ffffff;
  padding: 1rem;
  box-shadow: var(--shadow-sm);
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 10;
}
header h1 {
  font-size: 1.25rem;
  font-weight: 600;
}
header .icons { display:flex; gap:1rem; }
header .icons button {
  color: #ffffff;
  transition: color var(--transition);
}
header .icons button:hover {
  color: var(--accent);
}
.controls { display:grid; grid-template-columns: repeat(auto-fit,minmax(128px,1fr)); gap:.75rem; padding:1rem; background:var(--surface); box-shadow:var(--shadow-sm); }
.controls select, .controls button { width:100%; padding:.75rem 1rem; border-radius:var(--radius); border:1px solid #e2e8f0; font-size:.95rem; transition:border-color var(--transition),box-shadow var(--transition); background:var(--surface); }
.controls select:focus, .controls button:focus { outline:none; border-color:var(--primary-light); box-shadow:0 0 0 3px rgba(99,102,241,0.35); }
.controls button { background:var(--primary); color:#fff; font-weight:500; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:.5rem; }
.controls .range-wrapper { grid-column: span 6; padding:0 1rem; }
#verse-slider { width:100%; accent-color:var(--accent); }
#compare-container { grid-column: span 6; display:flex; flex-wrap:wrap; gap:.5rem; padding:.5rem; border:1px solid #e2e8f0; border-radius:var(--radius); background:#fafbfc; }
main { flex:1; display:grid; grid-template-columns:1fr 2fr; gap:1rem; overflow:hidden; padding:1rem; }
@media (max-width:900px) { main { flex-direction:column; display:flex; } }
aside#image-panel { background:var(--surface); border-radius:var(--radius); box-shadow:var(--shadow-md); display:flex; align-items:center; justify-content:center; height:100%; overflow:hidden; }
#verse-image { width:100%; height:100%; object-fit:cover; border-radius:var(--radius); }
.translations { overflow-y:auto; padding:1rem; }
.card { background:var(--surface); border-radius:var(--radius); box-shadow:var(--shadow-sm); margin-bottom:1rem; padding:1rem; position:relative; transition:transform var(--transition); }
.card:hover { transform:translateY(-2px); box-shadow:var(--shadow-md); }
.card h2 { font-size:1rem; font-weight:500; color:var(--primary); margin-bottom:.5rem; }
.card p { font-size:.95rem; line-height:1.5; margin-bottom:.75rem; }
.card .prog { font-size:.85rem; color:var(--neutral); text-align:right; }
/* Modals */
#search-modal, #compare-modal { display:none; position:fixed; inset:0; z-index:20; }
#search-modal.active, #compare-modal.active { display:block; }
.overlay, .search-overlay { position:absolute; inset:0; background:rgba(0,0,0,0.4); }
.search-panel, .compare-panel { position:absolute; top:10%; left:50%; transform:translateX(-50%); width:90%; max-width:600px; background:var(--surface); border-radius:var(--radius); padding:1rem; box-shadow:var(--shadow-md); max-height:85vh; overflow-y:auto; }
.search-panel header, .compare-panel header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
#search-close, #compare-close { background:none; border:none; font-size:1.25rem; cursor:pointer; }
.search-input-group { display:flex; gap:.5rem; margin-bottom:1rem; }
.search-input-group input { flex:1; padding:.5rem; border:1px solid #e2e8f0; border-radius:4px; }
.search-input-group button { padding:.5rem 1rem; border:none; background:var(--primary); color:#fff; border-radius:4px; cursor:pointer; }
.search-filters { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:.5rem; margin-bottom:1rem; }
.search-filters select { padding:.5rem; border:1px solid #e2e8f0; border-radius:var(--radius); }
#search-stats { font-size:.95rem; color:var(--neutral); margin-bottom:.5rem; }
#search-results { list-style:none; padding:0; }
#search-results li { padding:.5rem; border-bottom:1px solid #e2e8f0; cursor:pointer; transition:background var(--transition); }
#search-results li:hover { background:var(--bg); }
.compare-panel { max-width:700px; }
.compare-panel header h2 { margin:0; }
.compare-list { display:flex; flex-direction:column; gap:1rem; margin-bottom:1rem; }
.compare-entry { display:grid; grid-template-columns:1fr 1fr 1fr 1fr auto; gap:.5rem; align-items:center; }
.compare-entry select, .compare-entry button { padding:.5rem; border:1px solid #e2e8f0; border-radius:var(--radius); }
#add-compare-entry { background:var(--primary-light); color:#fff; border:none; padding:.5rem 1rem; border-radius:var(--radius); cursor:pointer; }
#compare-result { display:flex; gap:1rem; flex-wrap:wrap; }
.verse-block { flex:1; background:var(--bg); padding:.75rem; border-radius:var(--radius); box-shadow:var(--shadow-sm); }
.verse-block h3 { font-size:.95rem; margin-bottom:.5rem; color:var(--primary); }

/* Mobile-responsive tweaks */
@media (max-width: 600px) {
  .controls {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    padding: 0.75rem;
  }
  /* Primary dropdown and compare checkboxes full width */
  .controls select#primary,
  .controls #compare-container {
    grid-column: 1 / -1;
  }
  /* Book, Chapter, Verse each one column */
  .controls select#book   { grid-column: 1 / 2; }
  .controls select#chap   { grid-column: 2 / 3; }
  .controls select#verse  { grid-column: 3 / 4; }
  /* Prev/Next on full-width rows */
  .controls button#prev,
  .controls button#next {
    grid-column: 1 / -1;
    width: 100%;
  }
}
  </style>
</head>
<body>
  <header>
    <h1>Interactive Bible</h1>
    <div class="icons">
      <button id="global-search-btn" title="Search">üîç</button>
      <button id="compare-icon-btn" title="Compare Verses">üîÄ</button>
    </div>
  </header>

  <div class="controls">
    <select id="primary"></select>
    <div id="compare-container"></div>
    <select id="book"></select>
    <select id="chap"></select>
    <select id="verse"></select>
    <button id="prev">‚óÄ Prev</button>
    <button id="next">Next ‚ñ∂</button>
    <div class="range-wrapper">
      <input type="range" id="verse-slider">
    </div>
  </div>

  <main>
    <aside id="image-panel">
      <img id="verse-image" src="" alt="Verse Image">
    </aside>
    <div class="translations" id="output">
      <p style="color:var(--neutral)">Select a translation, book & chapter to begin...</p>
    </div>
  </main>

  <!-- Search Modal -->
  <div id="search-modal">
    <div class="search-overlay"></div>
    <div class="search-panel">
      <header><h2>Search Verses</h2><button id="search-close">‚úñ</button></header>
      <div class="search-input-group">
        <input id="search-input-global" placeholder="Search all verses‚Ä¶">
        <button id="start-search" disabled>Start</button>
      </div>
      <div class="search-filters">
        <select id="filter-translation"><option value="">All Bibles</option></select>
        <select id="filter-testament"><option value="">Both</option><option value="ot">OT</option><option value="nt">NT</option></select>
        <select id="filter-book"><option value="">All Books</option></select>
        <select id="filter-chapter"><option value="">All Chapters</option></select>
      </div>
      <div id="search-stats"></div>
      <ul id="search-results"></ul>
    </div>
  </div>

  <!-- Compare Modal -->
  <div id="compare-modal">
    <div class="overlay"></div>
    <div class="compare-panel">
      <header><h2>Compare Verses</h2><button id="compare-close">‚úñ</button></header>
      <div class="compare-list" id="compare-list"></div>
      <button id="add-compare-entry">Add Verse (+)</button>
      <div id="compare-result"></div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      function fillSelect(sel, items) {
        sel.innerHTML = '';
        items.forEach(i => sel.append(new Option(i.label, i.value)));
        sel.disabled = !items.length;
      }

      const primary       = document.getElementById('primary'),
            compareC      = document.getElementById('compare-container'),
            bookSel       = document.getElementById('book'),
            chapSel       = document.getElementById('chap'),
            verseSel      = document.getElementById('verse'),
            prevBtn       = document.getElementById('prev'),
            nextBtn       = document.getElementById('next'),
            verseSlider   = document.getElementById('verse-slider'),
            output        = document.getElementById('output'),
            verseImg      = document.getElementById('verse-image'),
            searchBtn     = document.getElementById('global-search-btn'),
            searchModal   = document.getElementById('search-modal'),
            searchClose   = document.getElementById('search-close'),
            globalInput   = document.getElementById('search-input-global'),
            startBtn      = document.getElementById('start-search'),
            resultsList   = document.getElementById('search-results'),
            statsDiv      = document.getElementById('search-stats'),
            compareIcon   = document.getElementById('compare-icon-btn'),
            compareModal  = document.getElementById('compare-modal'),
            compareClose  = document.getElementById('compare-close'),
            compareList   = document.getElementById('compare-list'),
            addEntry      = document.getElementById('add-compare-entry'),
            compareResult = document.getElementById('compare-result');
      const apiUrl = 'https://api.github.com/repos/mdudumi/thebim/contents/thebim/Translations';

      let transData = {}, lists = {}, state = { idx:0, bkIdx:0, chIdx:0 }, compareEntries = [];

      function nest(json) {
        const o = {};
        (json.verses||[]).forEach(v => {
          o[v.book_name] = o[v.book_name]||{};
          o[v.book_name][v.chapter] = o[v.book_name][v.chapter]||[];
          o[v.book_name][v.chapter].push(v.text);
        });
        return o;
      }

      // Fetch translations
      const files = await fetch(apiUrl).then(r=>r.json()).catch(()=>[]);
      for (let f of files) {
        if (!f.name.endsWith('.json')||f.name==='index.json') continue;
        const name = f.name.replace(/\.json$/,'');
        try {
          const data = await fetch(f.download_url).then(r=>r.json());
          transData[name] = nest(data);
          const books = Object.keys(transData[name]), chs = {};
          books.forEach(b=>chs[b]=Object.keys(transData[name][b]));
          lists[name] = { books, chapters:chs };
        } catch {}
      }

      // Populate translation dropdown & compare checkboxes
      const names = Object.keys(transData);
      fillSelect(primary, names.map(n=>({ label:n, value:n })));
      names.forEach(n => {
        const lbl = document.createElement('label');
        lbl.innerHTML = `<input type="checkbox" value="${n}"> ${n}`;
        compareC.append(lbl);
      });

      // Handlers
      primary.onchange = () => {
        state = { idx:0, bkIdx:0, chIdx:0 };
        fillSelect(bookSel, lists[primary.value].books.map((b,i) => ({ label:b, value:i })));
        fillSelect(chapSel, []);
        fillSelect(verseSel, []);
      };
      bookSel.onchange = () => {
        state.bkIdx = +bookSel.value;
        const bk = lists[primary.value].books[state.bkIdx];
        fillSelect(chapSel, lists[primary.value].chapters[bk].map((c,i) => ({ label:c, value:i })));
        fillSelect(verseSel, []);
      };
      chapSel.onchange = () => {
        state.chIdx = +chapSel.value;
        state.idx = 0;
        const bk = lists[primary.value].books[state.bkIdx];
        const ch = lists[primary.value].chapters[bk][state.chIdx];
        const vs = transData[primary.value][bk][ch] || [];
        fillSelect(verseSel, vs.map((_,i)=>({ label:i+1, value:i })));
        verseSlider.max = vs.length - 1;
        verseSlider.value = 0;
      };
      verseSel.onchange = () => {
        state.idx = +verseSel.value;
        renderAll();
      };
      prevBtn.onclick = ()=>navigate(-1);
      nextBtn.onclick = ()=>navigate(1);
      verseSlider.oninput = ()=>{ state.idx=+verseSlider.value; verseSel.value=state.idx; renderAll(); };
      compareC.addEventListener('change', ()=>{ if(!verseSel.disabled) renderAll(); });

      function navigate(delta) {
        const max = +verseSlider.max;
        state.idx = Math.max(0, Math.min(max, state.idx + delta));
        verseSel.value = state.idx;
        verseSlider.value = state.idx;
        renderAll();
      }

      function renderAll() {
        output.innerHTML = '';
        const { idx, bkIdx, chIdx } = state;
        const main = primary.value;
        const bk = lists[main].books[bkIdx];
        const ch = lists[main].chapters[bk][chIdx];
        verseImg.src = `images/${bkIdx+1}/${chIdx+1}/${idx+1}.jpg`;
        const checked = Array.from(compareC.querySelectorAll('input:checked'))
                             .map(i => i.value)
                             .filter(n => n !== main);
        const toShow = [ main, ...checked ];
        toShow.forEach(name => {
          const b2 = lists[name].books[bkIdx];
          const c2 = lists[name].chapters[b2][chIdx];
          const txt = (transData[name][b2]||{})[c2]?.[idx] || '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h2>${name}</h2>
            <p>${txt}</p>
            <div class="prog">${idx+1}/${(transData[name][b2]||{})[c2]?.length||0}</div>
          `;
          output.append(card);
        });
      }

      // Search modal
      searchBtn.onclick = ()=>{ searchModal.classList.add('active'); globalInput.value=''; startBtn.disabled=true; resultsList.innerHTML=''; statsDiv.textContent=''; };
      searchClose.onclick = ()=>searchModal.classList.remove('active');
      globalInput.oninput = ()=>startBtn.disabled=!globalInput.value.trim();
      startBtn.onclick = ()=> {
        const term = globalInput.value.trim().toLowerCase();
        let matches = [];
        names.forEach(n => {
          lists[n].books.forEach((b,i) => {
            lists[n].chapters[b].forEach((c,j) => {
              (transData[n][b][c]||[]).forEach((t,k) => {
                if (t.toLowerCase().includes(term)) matches.push({n,b,j,k,t});
              });
            });
          });
        });
        statsDiv.textContent = `Found ${matches.length}`;
        resultsList.innerHTML = '';
        matches.forEach(m => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>[${m.n}] ${m.b} ${m.j+1}:${m.k+1}</strong> ${m.t.substring(0,50)}‚Ä¶`;
          li.onclick = () => {
            searchModal.classList.remove('active');
            primary.value = m.n; primary.onchange();
            bookSel.value = lists[m.n].books.indexOf(m.b); bookSel.onchange();
            chapSel.value = m.j; chapSel.onchange();
            verseSel.value = m.k; verseSel.onchange();
          };
          resultsList.append(li);
        });
      };

      // Compare modal
      compareIcon.onclick = ()=>compareModal.classList.add('active');
      compareClose.onclick = ()=>compareModal.classList.remove('active');
      addEntry.onclick = ()=> {
        if (compareEntries.length < 5) {
          compareEntries.push({ trans: primary.value, bookIdx:0, chapIdx:0, verseIdx:0 });
          renderCompare();
        }
      };
      function renderCompare() {
        compareList.innerHTML = '';
        compareEntries.forEach((e,i) => {
          const div = document.createElement('div');
          div.className = 'compare-entry';
          const selT = document.createElement('select'),
                selB = document.createElement('select'),
                selC = document.createElement('select'),
                selV = document.createElement('select'),
                rm   = document.createElement('button');
          rm.textContent = '‚Äì';
          rm.onclick = () => { compareEntries.splice(i,1); renderCompare(); };
          fillSelect(selT, names.map(n=>({ label:n, value:n })));
          selT.value = e.trans;
          selT.onchange = ()=>{ e.trans = selT.value; updateBooks(); };
          function updateBooks() {
            const bs = lists[e.trans].books;
            fillSelect(selB, bs.map((b,idx)=>({ label:b, value:idx })));
            selB.value = e.bookIdx;
            selB.onchange();
          }
          selB.onchange = ()=> {
            e.bookIdx = +selB.value;
            const b = lists[e.trans].books[e.bookIdx];
            fillSelect(selC, lists[e.trans].chapters[b].map((c,idx)=>({ label:c, value:idx })));
            selC.value = e.chapIdx;
            selC.onchange();
          };
          selC.onchange = ()=> {
            e.chapIdx = +selC.value;
            const b = lists[e.trans].books[e.bookIdx];
            const c = lists[e.trans].chapters[b][e.chapIdx];
            fillSelect(selV, (transData[e.trans][b][c]||[]).map((_,idx)=>({ label:idx+1, value:idx })));
            selV.value = e.verseIdx;
            selV.onchange();
          };
          selV.onchange = ()=> {
            e.verseIdx = +selV.value;
            updateCompareResult();
          };
          updateBooks();
          div.append(selT, selB, selC, selV, rm);
          compareList.append(div);
        });
        addEntry.disabled = compareEntries.length >= 5;
        updateCompareResult();
      }
      function updateCompareResult() {
        compareResult.innerHTML = '';
        compareEntries.forEach(e => {
          const b = lists[e.trans].books[e.bookIdx];
          const c = lists[e.trans].chapters[b][e.chapIdx];
          const t = transData[e.trans][b][c][e.verseIdx] || '';
          const vb = document.createElement('div');
          vb.className = 'verse-block';
          vb.innerHTML = `<h3>${e.trans} ${b} ${e.chapIdx+1}:${e.verseIdx+1}</h3><p>${t}</p>`;
          compareResult.append(vb);
        });
      }

      // Auto-select first translation ‚Üí book 1 ‚Üí chapter 1 ‚Üí verse 1
      primary.disabled = false;
      primary.selectedIndex = 0;
      primary.onchange();
      bookSel.value = "0";
      bookSel.onchange();
      chapSel.value = "0";
      chapSel.onchange();
      verseSel.value = "0";
      verseSel.onchange();
    });
  </script>
</body>
</html>
